# 软件体系结构复习

## 绪论

### 描述什么是软件架构

**软件体系结构 = 组件 + 连接件 + 约束**

**组件**：具有某种功能的可重用的软件模块单元，表示了系统中主要的计算单元和数据存储。 

**连接件**：表示了组件之间的交互，简单的连接件有：管道（pipe）、过程调用 （procedure-call）、事件广播（event broadcast）等。复杂的连接件有：客户－服务器 （client-server）通信协议，数据库和应用之间SQL连接等。 

 **约束**：表示了组件和连接件的拓扑逻辑和约束（constraint）。

### 软件体系结构的研究活动

➢ 软件体系结构的建模与表示（ Architecture Modeling and Documenting） 

➢ 软件体系结构风格的研究(Software Architecture Styles) 

➢ 体系结构描述语言(Architecture Description Language,ADL) 

➢ 软件体系结构的评价方法(Architecture Evaluation) 

➢ 软件产品线及特定领域软件框架的研究(Product line and DSSA) 

➢ 动态软件体系结构

![image-20210620164944747](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620164944747.png)

### 软件体系结构的作用

![image-20210620165149569](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620165149569.png)

## 数据流体系结构风格

### 定义

描述特定领域中软件系统家族的组织方式的惯用模式 (idiomatic paradigm)，反映了领域中众多系统所共有 的结构和语义特性，并指导如何将各个模块和子系统有效 地组织成一个完整的系统

### 风格分类

![image-20210620195925127](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620195925127.png)

### 数据流体系风格

数据流体系风格就是数据为主题，数据流到达时工作，无数据时不工作。

#### 特点

1.数据 的可用性决定着处理<计算单元>是否执行

2.(系统结构由数据 在各处理之间的有序移动决定

3.在纯数据流系统中，处理之 间除了数据交换没有任何其他的交互

#### 基本构件-数据处理

![image-20210620200522911](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620200522911.png)

构件接口：输入和输出端口

计算模型：从输入端口 读数，经过计算/处理，然后写到输出端口

### 连接件-数据流

单向、 通常是异步、有缓冲

接口角色：reader 和writer

计算模型: 把数据从一个处理的输出端口 传送到另一个处理的输入端口

###  批处理风格

#### 定义

每个处 理步骤是一个独立的程序

每一步必须在前一步结束后才能开始

数据必 须是完整的，以整体的方式传递

#### 例子

基于eclipse的代码重复检测工具

###  管道-过滤体系结构风格

#### 定义

**场景**：数据不停的产生，系统需要若干个功能模块处理数据

**解决方案：**

✓ 把系统分解为几个序贯的处理步骤，这些步骤之间通过数据流连接， 一个步骤的输出是另一个步骤的输入； 

✓ 每个处理步骤由一个过滤器构件(Filter)实现；

 ✓ 处理步骤之间的数据传输由管道(Pipe)负责。

每一个处理步骤都是一个过滤器，都有输入和输出，从管道中读取数据流，经过内部处理后，产生输出数据流并写入管道中。

#### 构件

**过滤器（封装一个处理步骤**）：处理数据流

数据源点和数据终止点可以看作时特殊的filter。

目标是将源数据变换成目标数据，数据流->数据流

五种变换类型：增，删，转，合并，分解

独立性：无上下文信息、不保留状态、对其他过滤器无任何了解

**连接件**：管道pipe，连接两个过滤器，一个源，一个目的

特点：单向流、可能具有缓冲区、管道形成传输图

不同的管道种流动的数据可能具有不同的数据格式，取决于过滤器

#### 过滤器特点

递增的读取和消费数据，来就被处理，处理了就输出，流方式处理。

#### 例子

➢ Compiler (编译器) 

➢ Unix pipes (Unix管道) 

➢ Image processing (图像处理) 

➢ Signal processing (信号处理) 

➢ Voice and video streaming (声音与图像处理）

#### 优点

使构件具有良好的隐蔽性和高内聚、低耦合的特点，可将整个 系统的输入/输出行为看成多个过滤器的行为的简单合成； 

➢ 支持软件复用，只要提供适合在两个过滤器之间传送的数据， 任何两个过滤器都可被连接起来 

➢ 系统维护和增强系统性能简单，新的过滤器可以添加到现有系 统中来，旧的可以被改进的过滤器替换掉 

➢ 允许对一些如吞吐量、死锁等属性的分析 ➢ 支持并行执行：每个过滤器是作为一个单独的任务完成，因此 可与其它任务并行执行。

#### 缺点

➢ 不适合处理交互的应用 

✓在早期对交互应用需求不高的情况下提出 

✓当需要增量地显示改变时，这个问题尤为严重 

➢ 系统性能不高，并增加了编写过滤器的复杂性 

✓数据传输缺乏通用标准，每个过滤器都增加了解析和合 成数据的工作 

✓绝大部分处理时间消耗在格式转换上 

✓不适用于需要大量共享数据的应用设

### 批处理VS管道-过滤

1.把任务分解成为一系列固定顺序的计算单元 & 彼此间只通过数据传递交互

2.![image-20210620212825277](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620212825277.png)

##  软件体系结构-调用/返回风格

### 调用/返回风格

![image-20210620213302818](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210620213302818.png)

### 主程序/子程序风格

1.模块分解

2.封装/信息隐藏

### 数据抽象/面向对象

#### 面向对象体系结构的元素

封装：限制对某些信息的访问

交互：通过过程调用或类似的协议

多态：在运行时选择具体的操作

继承：对共享的功能保持唯一的接口

复用和维护：利用封装和聚合提高生产力

### 层次风格

#### 特点

每层为上一层提供服务，使用下一层的服务，只能见到与自己邻接的 层 – 适当时候(必不得已的时候)，可以允许一定的越层操作

 • 大的问题分解为若干个渐进的小问题，逐步解决，隐藏了很多复杂度 

• 修改一层，最多影响两层，而通常只能影响上层。接口稳固，则谁都 不影响 

• 上层必须知道下层的身份，不能调整层次之间的顺序 • 层层相调，影响性能

### 客户端/服务器风格

#### 两层C/S结构

基于资源不对等，且为了实现共享二提出的，分为三个组成部分：数据库服务器、客户应用程序和网络，服务器负责数据管理，客户机完成客户的交互任务。这样的话，对客户及的配置要求较高，客户端的程序设计复杂，因为直接访问服务器数据库，数据安全性差，用户界面风格不一，使用繁杂，软件维护与升级困难，每个客户机上的软件都需要维护。

#### 三层C/S结构

与两层结构相比，只增加了一个应用服务器。

整个应用逻辑驻留在应用服务器上，只有表示层存在于客 户机上

应用功能分为表示层（客户机）、功能层、数据层三层

– 表示层是应用的用户接口部分。通常使用图形用户界面

 – 功能层是应用的主体，实现具体的业务处理逻辑 

– 数据层是数据库管理系统。

– 以上三层逻辑上独立。 

– 通常只有表示层配置在客户机中

#### B/S结构（浏览器/服务器风格）

• B/S体系结构是三层C/S体系结构的特例

 • 客户端有http浏览器即可 – 为增强功能，往往还需要安装flash、jvm及一些专用插件 

• 使用标准http/https协议，省却很多麻烦

 • 只能“拉”，不能“推” •

 客户之间的通信只能通过服务器中转 

• 对客户机资源和其他网络资源的利用受限 

• B/S结构的安全性较难控制(SQL注入攻击…) 

• B/S结构的应用系统在数据查询等相应速度上，要远远低于C/S体系结构 

• 服务器的负荷大，客户机的资源浪费 – 用jvm、flash、ActiveX等客户端计算技术解决

## 体系结构风格

### 数据为中心的体系结构风格

定义：以数据为中心的风格架构涉及共享信息传递的数据源方法

比如：剪贴板，不停的copy暂存，不停的paste读取出数据

### 仓库体系结构风格

仓库是存储和维护数据的中心场所

组件：1.中心数据结构，表示当前数据的状态

2.一组对中心数据进行操作的独立构件

连接件：仓库与独立构件之间的交互

两种交互方式：1.数据库方式——输入流中的事务类型触发需要执行的过程。

2.黑板结构：中心数据结构的当前状态触发并选择需要执行的过程

核心问题是建立、扩大和维护一个复杂的中央信息体。

典型应用场景：

✓ 数据处理（数据处理），主要是由于需要从传统数据库构建业务决策系统。

✓ 软件开发环境（软件开发环境），主要由表示和操作程序和设计的需要驱动。

#### 应用实例

数据库  传统编译器结构：批处理/管道-过滤器 传统带符号表编译器结构  现代的规范编译器结构 仓库形式的编译器结构 基于仓库风格的软件研发环境

### 黑板体系结构风格

#### 基本结构

![image-20210621152457556](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210621152457556.png)

![image-20210621152528665](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210621152528665.png)

#### 数据结构

1.全局数据库，用来存储数据、传递信息，包含解域的全部状态

2.解决问题过程中的状态数据，一层次形式组织起来

3.知识源大队黑板进行修改，逐渐找到问题的解

4.各知识源之间的通讯和交互只通过黑板进行

#### 知识源

知识源是存储解决问题的知识和方法的地方，分别存放且相互独立，通过黑板进行通讯。条件-动作的形式存在。

![image-20210621153341450](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210621153341450.png)

#### 控制器

作用：时刻监视黑板的状态变化，对黑板的当前状态进行判断和评价，当黑板的状态满足知识源的出发条件后，知识源被控制器触发并进行计算，将结果更新到黑板上。更新会导致其他知识源继续参与，直到问题解决。

应用：

#### 黑板体系结构组成

➢ 黑板模型求解问题的推理机构，由监督程序和调度程序组成。 ➢ 监督程序根据黑板的状态变化激活相关知识源 

➢ 调度程序选择最合适的知识源来执行，用执行结果修改黑板状态。 

➢ 用来控制和协调所有的知识源，使其协同的解决问题； 

➢ 了解各个知识源的能力，实时决策解决问题的步骤；

应用：HEARSAY-II (自然语言处理系统，系统输入是自然语言的语音信号，经 过语音音节、词汇、句法和语义分析后，获得用户对数据库的查询请求)。

## 虚拟机风格

虚拟机风格分为解释器和规则系统

#### 解释器

模拟硬件非固有的功能

##### 解释器风格

问题：此模式适用于无法直接使用最适合执行解决方案的语言或机器的应用程序。
该模式也适用于核心

问题是定义表达解决方案的符号，例如作为脚本。
有时会在链中使用解释器，在一系列阶段中将所需的语言/机器翻译成可用的语言/机器。

• 上下文：解释器通常被设计为弥合所需机器或语言与执行环境已支持的某些（可能是虚拟的）机器或语言之间的差距

**– 系统模型**：虚拟机

**– 组件**：一个状态机（执行引擎）和三个存储器（执行引擎的当前状态、正在解释的程序、正在解释的程序的当前状态）

– **连接器**：数据访问和过程调用

**– 控制结构：**通常是执行引擎的状态转换；
用于选择解释内容的输入驱动

• 显着变体：专家系统通常作为代表专业知识的规则或产品集合的解释器来实现。
由于产生式需要复杂的选择规则，专门形式的解释器已经发展

##### 解释器优势

• 功能：

– 可以模拟非本地功能

• 测试：

– 可以模拟“灾难”模式（例如对于安全关键应用）

• 灵活性：

– 非常通用的工具

##### 劣势

效率：

– 比硬件慢得多

– 比编译系统慢得多

• 测试：

– 需要验证的附加软件层

##### 用途

• 解释型语言 – VB、Javascript、VBScript、HTML、Java字节码、Matlab – 脚本、配置文件

 • 通信协议 

• 用户输入 – 游戏中的组合按键

#### 规则系统

解释器专门化

##### 规则系统特征

要执行的代码（知识库）

• 解释引擎（规则解释器）

• 控制解释器的状态（规则/数据选择）

• 代码的当前状态（工作内存）

##### 实际的规则引擎-drools

Drools是Redhat公司JBoss业务逻辑智能模块

Drools是处理规则的专家系统

• 声明式编程 – 规则引擎允许你说“做什么”，而不是“怎样去做” 

• 规则系统能解决非常困难的难题

 • 逻辑和数据分离 

• 快捷和灵活 

• 知识集中化 

• 工具集成 

• 良好的解释机制

 • 易于理解的规则

产生式规则引擎：产生于系统庞大，业务繁杂，业务规则经常改变，24小时服务，业务同一管理，降低系统维护升级成本。

许多产品规则系统的大脑实际上是一个推理引擎，用于匹配事实和规则，当匹配被找到的时候，规则对应的动作会被触发，动作会改变事实的状态或者在应用上执行一些“外部”动作。

## 软件体系结构-事件系统

### 事件

能够激活对象功能的动作。当发生这种动作后将给所涉及对象发送一个消息，对象便可执行相应的功能。

### 事件系统

![image-20210622085116631](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622085116631.png)

#### 隐式调用

##### 特点

✓ 事件的触发者并不知道哪些构件会被这些事件影响，相互保持独立。 

✓ 不能假定构件的处理顺序，甚至不知道哪些过程会被调用。 

✓ 各个构件之间彼此之间无连接关系，各自独立存在，通过对事件的发布和注 册实现关联。

##### 基本结构与工作原理

![image-20210622091957959](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622091957959.png)

事件源、事件管理器

##### 基本构件

事件系统的基本构件：过程或函数，充当事件源或事件处理器的角色

事件

##### 连接机制

事件系统的连接件：事件过程绑定

过程（事件处理器）向特定的事件进行注册

构件（事件源）发布事件

当某些事件被发布时，向其注册的过程被隐式调用

调用的次序是不确定的

**在某些情况下，一个事件可能触发其他时间，形成事件链**

##### 应用实例

![image-20210622094052279](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094052279.png)

![image-20210622094107313](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094107313.png)

#### 事件系统派遣机制-调度机制

当事件发生时，意向此事件注册过的过程被激发并执行。

有两种派遣策略：1.无独立调度派遣模块的事件管理器

2.带有独立派遣模块的事件管理器

##### 无独立调度模块的事件系统

➢ This module is usually called Observable/Observer (被观察者/观 察者).

➢ Each module allows other modules to declare interest in  events that they are sending. (每一个模块都允许其他模块向自己 所能发送的某些消息表明兴趣) 

➢ Whenever a module sends an event, it sends that event to  exactly those modules that registered interest in that event. (当 某一模块发出某一事件时，它自动将这些事件发布给那些曾经向自己 注册过此事件的模块

![image-20210622094621751](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094621751.png)

##### 有独立事件派遣模块的事件系统

事件派遣模块是负责接收到来的事件并 派遣它们到其它模块。

派遣方式：

➢ 全广播式(All broadcasting) ：派遣模 块将事件广播到所有的模块，但只有感 兴趣的模块才去取出事件并触发自身的 行为；

![image-20210622094818657](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094818657.png)

 ➢ 选择广播式(Selected broadcasting) ： 派遣模块将事件送到那些已经注册的模 块中。

![image-20210622094835578](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094835578.png)

![image-20210622094920445](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622094920445.png)

![image-20210622095103813](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622095103813.png)

![image-20210622095118325](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622095118325.png)

**发布-订阅事件过期才会删除，点对点时消费完就删除**

##### 实例

![image-20210622095445346](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622095445346.png)

## 软件体系结构描述方法

### 软件体系结构描述

#### 概念

软件体系结构由一定形式的结构化元素组成，即是构件的集合。包括**处理构件、数据构件和连接 构件**。处理构件负责加工数据，数据构件代表被加工的信息，连接构件则负责组合连接不同的构件。

软件体系结构不仅是系统的蓝图，也是开发改系统项目的蓝图。 

◆ 它定义了工作分配。 

◆ 它是质量属性的主要载体。 

◆ 它是早期分析的最佳工具。

◆ 它是部署后维护和挖掘的关键。

◆ 描述软件系统结构是创建体系结构的最重要步骤。 

◆ 无论目前还是20年后，软件体系结构文档都能代表软件体系结构的设计思路

#### 作用

描述软件体系结构是理解体系结构设计思想、交流如何使用体系结构指导系统构建的基础。

#### 时机

当我们浏览自己公司的网站、与客户互动、或进行软件体系结构评估，都需要获得一份关于软件 体系结构的描述文档，作为交流的凭借。

#### 方式

工业界采用的传统描述方式存在一定的局限性，而专业的软件体系结构描述文档则可解决这一问题。

#### 建立描述文档的基本原则

◆ 1.从读者的角度写。 

◆ 2.避免不必要的重复。

 ◆ 3.避免歧义。 

◆ 4.使用标准组织结构。

 ◆ 5.记录理由。 

◆ 6.保持文档时效性但不是频繁更新 （有限的稳定性）。 

◆ 7.审查文档是否符合需求

### 软件体系结构建模

#### 视图

##### 概念

➢ “视图”的概念为我们提供了描述体系结构的原则： 

◆ 记录相关的意见 

◆ 然后添加适用于多个视图的信息 

◆ 从而将观点联系在一起 

➢ 架构元素–软件或硬件中存在的一组实际元素 

➢ 视图–由系统相关者编写和读取的一组连贯的 架构元素的表示

------------------------------------------------------------------------------------------

➢ 视图是一组架构元素及其关联关系的表示。 

➢ 但并非涵盖所有架构元素。 

➢ 视图绑定了体系结构描述时感兴趣的元素类型和关系类 型，并显示了它们。

➢ 视图是一种复杂的管理方法。

 ➢ 每个视图都可以回答有关体系结构的不同问题

 ◆ 主要执行单元和数据存储是什么？ 

◆ 其他软件如何使用该软件？ 

◆ 数据是如何在系统中流动的？ 

◆ 如何将软件部署到硬件上？

##### 类型

➢ 分解视图–显示与“关联的子模块”关系相关联的模块 

➢ 使用视图–显示与“使用”关系相关联的模块 （即，一个模块使用另一模块提供的服务） 

➢ 分层视图–显示被划分为相关和连贯功能的模块组。 每个组代表整体结构中的一个层。 

➢ 类/泛化视图–显示称为类的模块，这些模块通过关系的 “继承”或“实例”关联

➢ 进程视图–显示通过通信、同步和排除操作连接的进程或线程 

➢ 并发视图–显示组件和连接器，其中连接器代表“逻辑线程” 

➢ 共享数据（存储库）视图–显示创建、存储和访问持久数据的组件 和连接器 

➢ 客户端-服务器视图–显示协作的客户端和服务器以及它们之间的 连接器（即它们共享的协议和消息）

➢ 部署视图–显示软件元素及其对硬件和通信元素的分配 

➢ 实施视图–显示开发、集成和配置控制环境中的软件元 素及其到文件结构的映射 

➢ 工作分配视图–显示模块及其如何分配给负责实施和集 成它们的开发团队

##### 基于视图的体系结构建模规范

➢ 软件应用程序体系结构的规范称为体系结构描述。 

➢ 在IEEE 1471的术语中，系统具有体系结构，通过体系结构说明书来描述。

◆ 架构描述选择一个或多个视点。

 ◆ 每个视点包含了一个或多个相关的视图

 ◆ 视图由一个或多个模型组成，并集中一个视点。 

◆ 架构描述由一个或多个视图组成。

![image-20210622104618926](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622104618926.png)

###### 4+1视图

![image-20210622104744732](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622104744732.png)

![image-20210622104758994](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622104758994.png)

![image-20210622104811877](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622104811877.png)

###### UML视图

![image-20210622104919311](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622104919311.png)

![image-20210622105012760](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105012760.png)

![image-20210622105033813](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105033813.png)

![image-20210622105049108](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105049108.png)

![image-20210622105103489](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105103489.png)

![image-20210622105118471](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105118471.png)

![image-20210622105135262](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105135262.png)

![image-20210622105149987](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105149987.png)

![image-20210622105205470](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105205470.png)

![image-20210622105217651](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105217651.png)

![image-20210622105230485](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105230485.png)

![image-20210622105244855](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105244855.png)

![image-20210622105258280](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105258280.png)

![image-20210622105313712](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105313712.png)

![image-20210622105328417](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622105328417.png)

## 质量属性及其策略

### 质量属性的含义

属于非功能性需求，并不被功能所决定

✓ 实现功能特性必须给构成系统中的各个部分（模块） 赋予正确的职责、正确的资源和正确的调度顺序 

✓ 先实现功能，再谈质量属性

------

不同的软件项目，关注不同的质量属性---影响体系结构风格的选择

质量属性之间可能互相抑制---优先保证优先级的质量属性

必须结合设计、实现、部署3方面才能满足---缺一不可，在体系结构层面，就要考虑质量属性的实现

-----------------------------------------------------------------------------------------

常见的质量属性：

➢可用性（Availability） 

➢可修改性（Modifiability） 

➢性能（Performance） 

➢安全性（Security） 

➢可测试性（Testability） 

➢易用性（Usability）

### 质量属性场景

➢ 质量属性场景的6个组成部分 

➢ 刺激源（source）：谁造成的刺激 

➢ 刺激（stimulus）：一个影响系统的情况 

➢ 制品（artifact）：系统被影响的部分 

➢ 环境（environment）：刺激发生时系统所处的状态 

➢ 响应（response）：刺激所产生的结果 

➢ 响应衡量指标（response measure）：如何评估响应

![image-20210622113810587](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622113810587.png)

### 可用性

##### 定义

✓ 当用户使用系统时，系统可用的概率 

✓ 提前确定的停机维护不计入

##### 衡量指标

✓ 可用（或故障）时间百分比 

✓ 修复故障所需的时间 

✓ 平均无故障时间

##### 可用性场景

➢刺激源 

✓ 故障的迹象（来自内部或外部） 

➢刺激 

✓ 系统出错 

✓ 系统崩溃（反复出错） 

✓ 给出结果不准时（早或晚） 

✓ 给出错误结果

➢制品 

✓ 计算 or 存储 or 网络传输 

➢环境 

✓ 正常状态 or “亚健康”状态

➢响应 

✓ 记录日志（错误报告），回传给厂家 

✓ 通知管理员或其他系统

 ✓ 关闭系统，系统在维修期间不可用 

➢响应衡量指标 

✓ 故障时间百分比、修复故障所需时间、平均无故障时 间……

##### 提升可用性的策略

###### 策略

➢满足特定质量属性的具体设计手段 

➢是体系结构风格的基本单元

![image-20210622144123257](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622144123257.png)

###### 概述

![image-20210622144252551](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622144252551.png)

###### 故障检测

➢ Ping/echo ➢ 监控组件不定期向被监控组件发出ping消息，并根据收 到的echo消息（是否收到、延时）做出响应

➢ Heartbeat（心跳） ➢ 被监控组件定期向监控组件发出心跳消息 ➢ 在节点间保持周期性的心跳信号以检测各个节点的状态。若连续未收到的 心跳信号到了一定的数目，就认为相应的系统已经出现故障。

➢ Exceptions（异常） ➢ 抛出 + 捕获 + 处理 ➢ 需要编程语言支持

###### 故障恢复

**➢ 投票** 

➢ 多个冗余的组件，用统一或不同的算法来完成同一个任务。如果计算结 果不同，则少数服从多数

➢ 为降低同时出错的概率，多个组件可以由不同的开发团队在不同的软、 硬件平台上开发

➢ 主动冗余 ➢ A、B服务器完成同样的运算（A和B的状态时刻保持一致），平时只取 A算出的结果 ➢ 当A出现故障时，系统可以极快地切换到B

 ➢ 被动冗余 ➢ A服务器完成运算后的一定时间内把自身状态告知B，B再把自身状态更 新为A的状态。 ➢ 当A出现故障时，首先需要确认B的状态是最新的。

➢ 在重新上线前，都需要做状态的重新同步

➢ 内测 ➢ 开发人员修正bug，并在内部进行测试，确认无误后再发布补丁

➢ 检查点/回滚 ➢ 定期保存，便于恢复

###### 故障避免

➢服务下线 ➢惹不起，躲得起 ➢如果明确知道即将遭到毁 灭性攻击，不如主动下线

➢ 事务（Transaction） ➢ 多个操作必须全部完成 ➢ 案例：张三转账给李四包括2个 操作（减少张三账户余额、增加 李四账户余额），如果有任意一 个操作失败，则另一个也必须撤 销

➢ 进程监控 ➢ Windows任务管理器

### 可修改性

#### 含义

##### 概述

➢关注点 ✓修改的成本 ✓系统的哪些部分被修改 ✓修改发生的时间 ✓修改由谁来进行

➢衡量指标 ✓修改完成的时间 ✓修改所花的人力成本 ✓修改所花的经济成本

##### 可修改性场景

➢刺激源 ✓谁进行的修改（开发者/管理员/用户）

➢刺激 ✓要进行的具体修改

➢制品 ✓ 修改系统的功能 or UI or 交互的其他系统？

➢环境 ✓ 在什么时间进行的修改？设计期间 or 开发期 间 or 运行期间？ ✓ 修改的时间越迟，越不利

➢响应 ✓ 操作人员要理解如何修改、进行修改操作、测 试、部署

➢响应衡量指标 ✓ 时间、成本

![image-20210622145305746](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622145305746.png)

#### 可修改性的提升策略

##### 概述

![image-20210622145356001](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622145356001.png)

##### 限制修改范围

➢ 模块高内聚、低耦合 ➢ 尽量把对程序的修改控制在一个模块内 ➢ 可以借助框架、中间件

-------------------------------------------------------------------------------------------

➢ 考虑到可能会发生的修改 ➢ 有助于评估模块间责任的划分 ➢ 让一个点的修改只影响一个模块 ➢ 避免完全无关的多个修改会影响同一个模

------

➢ 让模块通用 ➢ “解释器”风格的思路

------

➢ 隐藏信息 ➢ 面向对象机制中的可访问性（public/private）

------

➢ 维持接口不变 ➢ 在接口不变的情况下，接口连接的双方可以独立变化

------

![image-20210622145702208](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622145702208.png)

------

➢ 使用中介 ➢ 数据中介：共享数据的风格 ➢ 服务中介：设计模式中的bridge、factory method等模式

------

➢ 命名服务器（name server） ➢ 查询所需资源 / 对象的位置，解决位置依赖

------

➢ 按需创建实例 ➢ 借助设计模式中的创建型模式

------

##### 延迟绑定时间

➢ 配置文件 ➢ 修改配置文件，而不用修改代码

------

![image-20210622145912418](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622145912418.png)

------

![image-20210622150101920](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150101920.png)

### 性能

#### 含义

##### 概述

➢关注点 ✓ 系统响应事件的速度 ✓ 和事件的数量和到达模式有关

➢事件的来源 ✓ 用户的请求、本系统内部、本系统外部

➢ 事件到达模式 ✓ 随机的 ✓ 在特定时间尺度（日、月、学期、年）有规律的

##### 性能场景

➢刺激源 ✓ 可能来自系统内部或外部

➢刺激 ✓ 事件到来（需要响应）

➢制品 ✓ 系统所提供的服务

➢环境 ✓ 系统可能处于不同的模式（正常 / 紧急 / 超载）

➢ 响应 ✓ 系统处理到来的事件，可能会导致状态的变化

➢ 响应衡量指标 ✓ 处理事件所花的时间 ✓ 单位时间内处理事件的数目 ✓ 处理的错误率/丢失率

![image-20210622150513473](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150513473.png)

#### 提升性能的策略

##### 概述

![image-20210622150544433](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150544433.png)

##### 资源的需求

![image-20210622150631844](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150631844.png)

![image-20210622150649352](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150649352.png)

![image-20210622150707615](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150707615.png)

##### 资源的管理

![image-20210622150804000](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150804000.png)

![image-20210622150816783](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150816783.png)

##### 资源的仲裁

![image-20210622150841464](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150841464.png)

![image-20210622150855132](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622150855132.png)

### 安全性

#### 含义

##### 概述

➢ 关注点 ✓ 在保证合法用户使用系统的前提下，抵抗对系统的攻击

➢ 攻击（威胁） ✓ 试图突破系统安全性防护的尝试

➢ 安全性的不同方面 ✓ 不可否认性 ✓ 私密性✓ 完整性 ✓ 保证性✓ 可用性 ✓ 审计（为了重建）

##### 安全性场景

➢ 刺激源 ✓ 攻击可能由人或其他系统发起

➢ 刺激 ✓ 对系统的攻击（或试图突破系统安全保护） ✓ 常见形式：窃取或修改信息、获取超权限的服务、降低系统 可用性

➢ 制品 ✓ 系统所提供的服务或系统中的数据

➢ 环境 ✓ 系统可能处于不同的情况下（联网/未联网、在线/下线、 在防火墙内/外）

➢ 响应 ✓ 合法用户正常使用，拒绝非法用户的使用 ✓ 对攻击有威慑

➢ 响应衡量指标 ✓ 发起攻击的难度 ✓ 从攻击中恢复的难度

![image-20210622151204335](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622151204335.png)

#### 提升安全性的策略

##### 概述

➢方向1：抵抗攻击

➢方向2：检测攻击

➢方向3：从攻击中恢复

##### 抵抗攻击

➢ 用户的证实 ➢ 密码、验证码、生物识别……

➢ 用户的授权 ➢ 确认用户的操作是在其权限范围

➢ 维持数据的保密性 ➢ 给数据和传输过程加密

➢ 维持数据的完整性 ➢ MD5码校验

➢ 减少暴露 ➢ 关闭无用端口、自启动的服务、无线路由SSID等

➢ 限制访问 ➢ 白名单、黑名单

##### 检测攻击

➢ 软件和人结合 ➢ 入侵检测系统 ➢ 安全专家

➢ 恢复状态 ➢ 使用“可用性”中的相关策略

➢ 攻击者的识别 ➢ 也能震慑潜在的攻击者

### 可测试性

#### 含义

##### 概述

➢ 关注点 ✓ 让软件的bug容易被测试出来 ✓ 验证软件产品与它的需求规格是否匹配（存在不符或缺失） ✓ 使用最小的成本和工作量来验证软件的质量

➢ 测试的重要性 ✓ 一般软件项目40%的成本花在测试上 ✓ 大型软件项目出现故障，可能导致严重的后果 ✓ 如果能在体系结构层面提高可测试性，收益巨大

##### 案例

➢ 软件bug引发的重大损失 

✓ 1985年，加拿大的Therac-25放射治疗机由于软件Bug而发生 故障，向患者提供了致命的辐射剂量，造成3人死亡，3人严重 受伤。 ✓ 1994年，国航空客A300因软件故障而坠毁，264人丧生 

✓ 1999年，软件漏洞导致美国12亿美元的军事卫星发射失败

✓ 2013-2016年，日产汽车由于安全气囊感应探测器的软件故障 （软件可能探测不到副驾驶座上的乘客，导致发生事故时安全 气囊无法打开），陆续在全球召回超过450万辆汽车 

✓ 2015-2017年，星巴克咖啡多次出现POS系统升级故障无法处 理交易，最多时被迫临时关闭了北美区约60％的门店

✓ 2015年，伦敦彭博终端由于软件漏洞宕机，影响超过30万交 易商，迫使政府推迟30亿英镑的债务出售

✓ 2018年6月27日，阿里云出现大规模故障，原因为上线自动化 运维系统触发未知Bug，导致部分产品访问链接不通，影响时 间约半小时

##### 可测试性场景

➢ 刺激源 ✓ 测试可能由不同的角色发起（开发者、单元测试人员、集成测 试人员、系统管理员、用户……）

➢ 刺激 ✓ 系统开发到达了里程碑 ✓ 可能是分析/设计/编码/集成阶段的结束，或系统完成开发

➢ 制品 ✓ 一个设计、一段代码、整个系统……

➢ 环境 ✓ 系统可能处于设计阶段 / 开发阶段 / 部署阶段 / 正常运行时

➢ 响应 ✓ 理想的响应是可以进行测试，并且可以观察到测试结果 ✓ 当测试结果无法被观察到时，测试难度很大

➢ 响应衡量指标 ✓ 白盒测试中的覆盖率 ✓ 语句覆盖 ✓ 判定覆盖/分支覆盖（判定可能是多个条件组合） ✓ 条件覆盖：覆盖判定中的每个条件 ✓ 路径覆盖、判定条件覆盖、条件组合覆盖…… ✓ 未来继续发现bug的概率

![image-20210622152219520](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152219520.png)

#### 提升可测试性的策略

##### 概述

![image-20210622152257817](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152257817.png)

##### 黑盒测试

![image-20210622152313011](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152313011.png)

![image-20210622152334740](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152334740.png)

##### 白盒测试

![image-20210622152349960](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152349960.png)

##### 常用的测试工具

![image-20210622152510868](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152510868.png)

![image-20210622152525794](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152525794.png)

![image-20210622152541478](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152541478.png)

### 易用性

#### 含义

##### 概述

![image-20210622152637405](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152637405.png)

##### 易用性场景

➢ 刺激源 ✓ 终端用户

➢ 刺激 ✓ 终端用户希望学习系统的使用、提高系统使用效率、减少 出错……

➢ 制品 ✓ 整个系统

➢ 环境 ✓ 系统处于运行时或配置时

➢ 响应 ✓ 系统响应用户的要求

➢ 响应衡量指标 ✓ 用户完成任务的时间 ✓ 用户出错的次数 ✓ 用户满意度 ✓ 用户操作的成功率

![image-20210622152903391](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152903391.png)

#### 提升易用性的策略

##### 概述

![image-20210622152942273](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622152942273.png)

##### 运行时策略

➢ 系统猜测用户要完成的任务 ➢ 输入法联想、搜索引擎联想

➢ 系统给用户适当的反馈 ➢ 提示拷贝文件所需的剩余时间、浏览器打开页面的进度

➢ 系统给用户提供一致的体验 ➢ 鼠标提供DPI调整，适应不同的分辨率

➢ 支持撤销操作 ➢ 减少误操作的影响

##### 设计时策略

![image-20210622153154926](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622153154926.png)

## 软件体系结构评估

### 体系结构评估

#### 定义

架构评估是一个开发生命周期活动，多个项目干系人在正式或非正式过程中使用场景等评估技术分析软件架构。

#### 为什么

![image-20210622154036436](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622154036436.png)

1.越早发现越好，及时止损

2.需求验证➢ 架构评估揭示了冲突和权衡，并为协商解决提供了一个论坛

3.强制准备审查

➢ 许多系统没有一个所有开发人员都能理解的架构。
在准备评估的过程中会发现很多这样的问题

4.改进的架构

#### 评估方法

基于场景的架构分析方法（SAAM）

这可能是第一个记录在案的软件架构分析方法，最初开发用于分析架构的可修改性。但是，它对于分析架构的任何非功能方面都很有用。它建立在使用利益相关者生成的场景来评估架构的基础上。

架构权衡分析方法（ATAM）

这是 SAAM 的继任者，并且也得到了广泛使用。

➢ 该方法在架构分析中结合了质量属性效用树和质量属性类别。

➢ 虽然 SAAM 没有明确解决质量属性之间的相互作用，但 ATAM 却有。
因此，权衡是关于竞争的质量属性。

➢ ATAM 是 SAAM 的一个专长，特别关注可修改性、性能、可用性和安全性。

------

------

SAAM 建立在复杂场景 (SAAMCS) 上

该方法将评估场景的复杂性视为最重要的风险评估因素

通过域中的集成扩展 SAAM (ESAAMI)

这种方法将 SAAM 与特定领域和基于重用的软件开发过程集成在一起。

面向演化和可重用性的软件架构分析方法 (SAAMER)

这种方法特别关注进化（回顾）和可重用性的质量属性。

基于场景的架构再造 (SBAR)

该方法利用场景、模拟（simulation）、数学建模和基于经验的推理（基于经验的推理）来评估质量属性。
该方法还结合了架构设计方法。

软件维护的架构级预测（ALPSM）


这是使用场景分析可维护性的另一种方法，称为变更场景，代表维护任务

软件架构评估模型（SAEM）

这种方法是基于正式的和严格的（严格许可的）质量要求。

#### ATAM-重点掌握

##### 概述

ATAM 是一种帮助项目干系人提出正确问题以发现可能存在问题的架构决策的方法。

权衡（折衷）可以明确识别和记录

 然后可以将发现的风险作为缓解（实践）活动的重点：例如
进一步设计、进一步分析、原型制作。

##### 目标

ATAM 的目的不是提供精确的分析。目的是发现架构决策造成的风险。

我们想要找到趋势：架构决策和系统属性预测之间的相关性

执行 ATAM 评估有很多好处

✓已识别的风险

✓明确了质量属性要求

✓改进的架构文档

✓ 架构决策的文件化基础

✓增加利益相关者之间的沟通

结果是改进的架构。

##### 评估小组

![image-20210622160154319](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622160154319.png)

![image-20210622160208948](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622160208948.png)

##### 评估阶段

![image-20210622160330167](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622160330167.png)

###### ATAM-Phase0

此阶段在技术评估之前

客户和评估团队的一个子集就要评估其体系结构的方法和系统交换理解。

制定了执行评估的协议。

核心评估团队登场。

###### ATAM-Phase1

![image-20210622162522016](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622162522016.png)

专注于获取详细的架构信息并对其进行分析

➢涉及一小群主要以技术为导向的项目相干人

➢ 以架构为中心

➢ 自上而下的分析

------

1.评估组对 ATAM 进行了概述

➢ ATAM 步骤简述

➢ 技巧

✓ 效用树（效用树）生成

✓ 架构启发和分析

✓ 场景头脑风暴/映射

➢ 输出

✓ 架构方法

✓ 实用树和场景

✓ 风险、非风险、敏感点和权衡



2.客户描述系统的业务驱动因素。

➢ 系统的业务环境

➢ 高级功能需求

➢ 高级质量属性要求

✓ 架构驱动因素：“塑造”架构的质量属性

✓ 关键要求：质量属性对系统的成功至关重要



3.Designer 呈现架构设计的概述。

➢ 技术限制，如规定使用的操作系统、硬件或中间件

➢ 系统必须与之交互的其他系统

➢ 用于解决质量属性要求的架构方法



4.确定核心架构方法。

➢ 客户端-服务器

➢ 三层

➢ 事件调度机制

➢ 发布订阅

➢ 冗余硬件

评估人员开始确定架构中实现质量属性目标的关键位置。



5.通过构建效用树来识别、优先排序和优化最重要的质量属性目标。（效用树 是一个自顶向下的工具，用来刻画重要的需求）

驱动质量属性是高级节点（通常是性能、可修改性、安全性和可用性）

场景是效用树的叶子。

![image-20210622161638120](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622161638120.png)

输出：特定质量属性的特征和优先级



刺激、环境、反应

➢ 用例场景

✓ 远程用户在高峰期通过Web 请求数据库报告，并在5 秒内收到。

➢ 增长情景

✓ 添加新的数据服务器，将场景 1 中的延迟减少到 1 人周内的 2.5 秒。

➢ 探索性场景

✓ 一半的服务器在正常运行期间宕机，而不会影响整体系统可用性



6.评估团队从特定质量属性的角度探索架构方法以识别风险。

➢ 确定架构方法

➢ 针对最高优先级场景询问质量属性特定问题

➢ 识别和记录风险和非风险、敏感点和权衡



**敏感点：**

风险、权衡、敏感性、非风险

➢ 敏感点是一个或多个组件（和/或组件关系）的属性，它对于实现特定的质量属性响应至关重要。

✓“虚拟专用网络中的机密级别可能对加密位数很敏感。

**权衡点：**

风险、权衡、敏感性、非风险

➢权衡点是影响多个属性的属性，是多个属性的敏感点。

✓“更改加密级别可能会对安全性和性能产生重大影响。”

**风险决策：**

风险、权衡、敏感性、非风险

➢风险是一个潜在的有问题的架构决策。

✓“虚拟专用网络中的机密级别可能对加密位数很敏感。 

**无风险决策**

风险、权衡、敏感性、非风险

➢ 非风险是经过分析认为安全的良好架构决策。

✓“假设消息到达率为每秒一次，处理时间小于 30 毫秒，并且存在一个更高优先级的进程，那么 1 秒的软截止时间似乎是合理的。”（（假定消息的 到达速率是每秒一次，一次处理的时间小于30ms。如果对一个更 高优先级的处理的响应时间要求是1秒钟，此系统可行）

###### ATAM-Phase 2

![image-20210622162613061](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622162613061.png)

➢ 阶段 2：涉及更多的项目干系人

➢ 第二阶段是

✓以项目干系人为中心

✓ 专注于引出不同项目干系人的观点并验证第一阶段的结果。

如何？

项目干系人使用便利的头脑风暴过程生成场景。
效用树叶子上的场景作为示例以促进该步骤。

➢ 阶段 2：涉及更多的利益相关者

➢ 第二阶段是

✓以利益相关者为中心

✓ 专注于引出不同利益相关者的观点并验证第一阶段的结果。



7. 利益相关者使用便利的头脑风暴过程生成场景。

   ➢ 效用树的叶子处的场景作为示例以促进该步骤。

![image-20210622163136345](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622163136345.png)

8. 确定受上一步生成的场景影响的架构方法。

➢ 此步骤使用新场景继续在步骤 6 中开始的分析。

➢ 继续识别风险和非风险。

➢ 继续注释架构信息。

9. 概括（概括） ATAM 的所有步骤并呈现 ATAM 输出。

➢ 架构方法

➢ 实用树

➢ 场景

➢ 风险与非风险

➢ 敏感点和权衡

➢ 风险主题

###### ATAM-Phase 3

主要包括为客户编写最终报告，以及评估和 ATAM 材料的质量  

➢ 执行摘要

➢ ATAM 说明

➢ 业务驱动和架构描述

➢ 阶段 1 和阶段 2 场景和效用树列表

➢ 阶段 1 和阶段 2 分析：架构方法、决策、风险、敏感性、权衡和非风险

➢ 风险主题

➢ 下一步

###### 总结

ATAM 是

✓一种针对多个质量属性评估架构的方法

✓ 发现架构决策后果的有效策略

✓一种识别趋势的方法，而不是进行精确分析

![image-20210622163539192](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622163539192.png)

![image-20210622163436929](C:\Users\24453\AppData\Roaming\Typora\typora-user-images\image-20210622163436929.png)

